# Markdown 格式化配置说明

本文档说明如何配置编辑器以实现 Markdown 文件保存时自动格式化。

---

## 一、配置文件说明

### 1. VS Code 设置（`.vscode/settings.json`）

此文件配置了 VS Code 编辑器的行为，包括：

- **保存时自动格式化**：`editor.formatOnSave: true`
- **Markdown 专用格式化器**：使用 Prettier 作为默认格式化工具
- **文件编码**：UTF-8
- **行尾符**：LF（Unix 风格）
- **自动删除尾随空格**：`files.trimTrailingWhitespace: true`
- **文件末尾自动换行**：`files.insertFinalNewline: true`

### 2. Prettier 配置（`.prettierrc.json`）

此文件定义了 Prettier 格式化器的规则：

- **行宽**：100 字符
- **缩进**：2 个空格
- **不使用制表符**：`useTabs: false`
- **Markdown 特殊处理**：保持原始换行（`proseWrap: "preserve"`）

### 3. EditorConfig 配置（`.editorconfig`）

此文件提供跨编辑器的统一配置：

- **字符编码**：UTF-8
- **行尾符**：LF
- **缩进**：2 个空格
- **Markdown 文件**：自动删除尾随空格，文件末尾自动换行

---

## 二、安装必要的扩展

### VS Code 扩展

1. **Prettier - Code formatter**
   - 扩展 ID：`esbenp.prettier-vscode`
   - 功能：提供代码格式化功能

### 安装方法

1. 打开 VS Code
2. 按 `Ctrl+Shift+X`（Windows/Linux）或 `Cmd+Shift+X`（Mac）打开扩展面板
3. 搜索 "Prettier - Code formatter"
4. 点击安装

---

## 三、使用方法

### 自动格式化

配置完成后，每次保存 Markdown 文件时会自动：

1. **删除尾随空格**
2. **统一行尾符为 LF**
3. **确保文件末尾有换行符**
4. **格式化代码块**（如果包含）

### 手动格式化

如果自动格式化未生效，可以手动触发：

- **快捷键**：`Shift+Alt+F`（Windows/Linux）或 `Shift+Option+F`（Mac）
- **命令面板**：
  1. 按 `Ctrl+Shift+P`（Windows/Linux）或 `Cmd+Shift+P`（Mac）
  2. 输入 "Format Document"
  3. 选择 "Format Document"

---

## 四、常见问题排查

### 问题 1：保存时未自动格式化

**解决方案**：

1. 检查是否安装了 Prettier 扩展
2. 检查 `.vscode/settings.json` 中的 `editor.formatOnSave` 是否为 `true`
3. 检查 `.prettierrc.json` 文件是否存在
4. 重启 VS Code

### 问题 2：格式化规则不符合预期

**解决方案**：

1. 检查 `.prettierrc.json` 中的配置
2. 确保 VS Code 使用项目级配置而非用户级配置
3. 检查是否有其他格式化工具冲突（如 Beautify）

### 问题 3：Markdown 表格格式被破坏

**解决方案**：

Prettier 配置中已设置 `proseWrap: "preserve"`，这应该能保持 Markdown 的原始换行。如果仍有问题：

1. 检查 `.prettierrc.json` 中的 `overrides` 部分
2. 确保 Markdown 文件的 `proseWrap` 设置为 `"preserve"`

---

## 五、配置验证

### 测试步骤

1. 创建一个测试文件 `test.md`：

```markdown
# 测试标题

这是一段文本，末尾有空格
这是另一段文本

- 列表项 1
- 列表项 2
```

1. 保存文件（`Ctrl+S`）
2. 检查文件是否自动格式化：
   - 尾随空格应被删除
   - 文件末尾应有换行符
   - 行尾符应为 LF

---

## 六、配置优先级

配置文件的优先级（从高到低）：

1. **`.vscode/settings.json`**（项目级 VS Code 设置）
2. **`.prettierrc.json`**（Prettier 配置）
3. **`.editorconfig`**（EditorConfig 配置）
4. **用户级 VS Code 设置**

---

## 七、最佳实践

1. **提交前检查**：虽然已配置自动格式化，但建议在提交前手动检查格式
2. **团队协作**：确保团队成员都安装了相同的扩展和配置
3. **版本控制**：将配置文件纳入版本控制，确保团队使用统一配置
4. **定期更新**：保持 Prettier 扩展和配置文件的更新

---

## 八、相关文档

- [Prettier 官方文档](https://prettier.io/docs/en/)
- [EditorConfig 官方文档](https://editorconfig.org/)
- [VS Code 格式化文档](https://code.visualstudio.com/docs/editor/codebasics#_formatting)

---

## 九、配置更新日志

- **2025-01-XX**：初始配置创建
  - 添加 VS Code 设置
  - 添加 Prettier 配置
  - 添加 EditorConfig 配置
  - 创建配置说明文档

---

## 十、故障排除

如果遇到问题，请按以下步骤排查：

1. **检查扩展**：确保 Prettier 扩展已安装并启用
2. **检查配置**：验证所有配置文件是否存在且格式正确
3. **检查日志**：查看 VS Code 输出面板中的 Prettier 日志
4. **重置配置**：如果问题持续，尝试删除配置文件后重新创建

---

**注意**：此配置仅适用于 VS Code 编辑器。如果使用其他编辑器，请参考相应编辑器的配置方法。
